////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_area_onexit.nss
//      Version : 0.1
//         Date : 7/25/06
//       Author : Ronan
//
//  Local Variable Prefix =
//
//
//  Dependencies external of nwscript:
//
//  Description
//  This script calls the ACR's OnAreaExit code, and any custom code a server
//  may need. It is not updated in ACR updates.
//
//  Revision History
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

#include "acr_area_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

const string AoEPrefix = "KNGSBAY_PATROL_AOE_";

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

// The main event handler.
void main();

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

int NeedsQuestCleanup()
{
	object oPC = GetFirstPC(TRUE);
	while(GetIsObjectValid(oPC))
	{
		if(oPC != GetExitingObject() &&
		   GetArea(oPC) == OBJECT_SELF)
		{
			return FALSE;
		}
		oPC = GetNextPC(TRUE);
	}
	return TRUE;
}

void CleanUpQuest()
{
	int count = 1;
	object oAoE = GetObjectByTag(AoEPrefix + IntToString(count));
	while(GetIsObjectValid(oAoE))
	{
		DestroyObject(oAoE, 0.0f);
		count++;
		oAoE = GetObjectByTag(AoEPrefix + IntToString(count));
	}
}

void main()
{
	ACR_AreaOnExit(); 
	
	if(NeedsQuestCleanup())
		CleanUpQuest();
}